{"remainingRequest":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\src\\views\\chatroom\\chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\src\\views\\chatroom\\chat.vue","mtime":1646987707157},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHdzOiBudWxsLA0KICAgICAgY291bnQ6IDAsDQogICAgICB1c2VySWQ6IG51bGwsIC8v5b2T5YmN55So5oi3SUQNCiAgICAgIGxpc3Q6IFtdLCAvL+iBiuWkqeiusOW9leeahOaVsOe7hA0KICAgICAgY29udGVudFRleHQ6ICIiIC8vaW5wdXTovpPlhaXnmoTlgLwNCiAgICB9Ow0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0VXNlcklEKCk7DQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy5pbml0V2ViU29ja2V0KCk7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvL+agueaNruaXtumXtOaIs+S9nOS4uuW9k+WJjeeUqOaIt0lEDQogICAgZ2V0VXNlcklEKCkgew0KICAgICAgbGV0IHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsNCiAgICAgIHRoaXMudXNlcklkID0gdGltZTsNCiAgICB9LA0KICAgIC8v5qC55o2udXNlcklE55Sf5oiQ5LiA5Liq6ZqP5py65aS05YOPDQogICAgZ2V0VXNlckhlYWQoaWQsIHR5cGUpIHsNCiAgICAgIGxldCBJRCA9IFN0cmluZyhpZCk7DQogICAgICBpZiAodHlwZSA9PSAiYmNrIikgew0KICAgICAgICByZXR1cm4gTnVtYmVyKElELnN1YnN0cmluZyhJRC5sZW5ndGggLSAzKSk7DQogICAgICB9DQogICAgICBpZiAodHlwZSA9PSAicG9seWdvbiIpIHsNCiAgICAgICAgcmV0dXJuIE51bWJlcihJRC5zdWJzdHJpbmcoSUQubGVuZ3RoIC0gMikpOw0KICAgICAgfQ0KICAgICAgaWYgKHR5cGUgPT0gInJvdGF0ZSIpIHsNCiAgICAgICAgcmV0dXJuIE51bWJlcihJRC5zdWJzdHJpbmcoSUQubGVuZ3RoIC0gMykpOw0KICAgICAgfQ0KICAgIH0sDQogICAgLy/mu5rliqjmnaHliLDlupXpg6gNCiAgICBzY3JvbGxCb3R0bSgpIHsNCiAgICAgIGxldCBlbCA9IHRoaXMuJHJlZnNbIm1zZy1ib3giXTsNCiAgICAgIGVsLnNjcm9sbFRvcCA9IGVsLnNjcm9sbEhlaWdodDsNCiAgICB9LA0KICAgIC8v5Y+R6YCB6IGK5aSp5L+h5oGvDQogICAgc2VuZFRleHQoKSB7DQogICAgICBsZXQgX3RoaXMgPSB0aGlzOw0KICAgICAgX3RoaXMuJHJlZnNbInNlbmRNc2ciXS5mb2N1cygpOw0KICAgICAgaWYgKCFfdGhpcy5jb250ZW50VGV4dCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBsZXQgcGFyYW1zID0gew0KICAgICAgICB1c2VySWQ6IF90aGlzLnVzZXJJZCwNCiAgICAgICAgbXNnOiBfdGhpcy5jb250ZW50VGV4dA0KICAgICAgfTsNCiAgICAgIF90aGlzLndzLnNlbmQoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7IC8v6LCD55SoV2ViU29ja2V0IHNlbmQoKeWPkemAgeS/oeaBr+eahOaWueazlQ0KICAgICAgX3RoaXMuY29udGVudFRleHQgPSAiIjsNCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBfdGhpcy5zY3JvbGxCb3R0bSgpOw0KICAgICAgfSwgNTAwKTsNCiAgICB9LA0KICAgIC8v6L+b5YWl6aG16Z2i5Yib5bu6d2Vic29ja2V06L+e5o6lDQogICAgaW5pdFdlYlNvY2tldCgpIHsNCiAgICAgIGxldCBfdGhpcyA9IHRoaXM7DQogICAgICAvL+WIpOaWremhtemdouacieayoeacieWtmOWcqHdlYnNvY2tldOi/nuaOpQ0KICAgICAgaWYgKHdpbmRvdy5XZWJTb2NrZXQpIHsNCiAgICAgICAgLy8gMTkyLjE2OC4wLjExNSDmmK/miJHmnKzlnLBJUOWcsOWdgCDmraTlpITnmoQgOjgxODEg56uv5Y+j5Y+3IOimgeS4juWQjuerr+mFjee9rueahOS4gOiHtA0KICAgICAgICBsZXQgd3MgPSBuZXcgV2ViU29ja2V0KCJ3czovLzEyNy4wLjAuMTo4MDgxIik7DQogICAgICAgIF90aGlzLndzID0gd3M7DQogICAgICAgIHdzLm9ub3BlbiA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZygi5pyN5Yqh5Zmo6L+e5o6l5oiQ5YqfIik7DQogICAgICAgIH07DQogICAgICAgIHdzLm9uY2xvc2UgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgY29uc29sZS5sb2coIuacjeWKoeWZqOi/nuaOpeWFs+mXrSIpOw0KICAgICAgICB9Ow0KICAgICAgICB3cy5vbmVycm9yID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgY29uc29sZS5sb2coIuacjeWKoeWZqOi/nuaOpeWHuumUmSIpOw0KICAgICAgICB9Ow0KICAgICAgICB3cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgLy/mjqXmlLbmnI3liqHlmajov5Tlm57nmoTmlbDmja4NCiAgICAgICAgICBsZXQgcmVzRGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTsNCiAgICAgICAgICBpZiAocmVzRGF0YS5mdW5OYW1lID09ICJ1c2VyQ291bnQiKSB7DQogICAgICAgICAgICBfdGhpcy5jb3VudCA9IHJlc0RhdGEudXNlcnM7DQogICAgICAgICAgICBfdGhpcy5saXN0ID0gcmVzRGF0YS5jaGF0Ow0KICAgICAgICAgICAgY29uc29sZS5sb2cocmVzRGF0YS5jaGF0KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgX3RoaXMubGlzdCA9IFsNCiAgICAgICAgICAgICAgLi4uX3RoaXMubGlzdCwNCiAgICAgICAgICAgICAgeyB1c2VySWQ6IHJlc0RhdGEudXNlcklkLCBjb250ZW50OiByZXNEYXRhLm1zZyB9DQogICAgICAgICAgICBdOw0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICB9DQogIH0NCn07DQo="},{"version":3,"sources":["chat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chat.vue","sourceRoot":"src/views/chat","sourcesContent":["<template>\r\n  <div class=\"chat-box\">\r\n    <header>聊天室人数：{{count}}</header>\r\n    <div class=\"msg-box\" ref=\"msg-box\">\r\n      <div\r\n        v-for=\"(i,index) in list\"\r\n        :key=\"index\"\r\n        class=\"msg\"\r\n        :style=\"i.userId == userId?'flex-direction:row-reverse':''\"\r\n      >\r\n        <div class=\"user-head\">\r\n          <div\r\n            class=\"head\"\r\n            :style=\"` background: hsl(${getUserHead(i.userId,'bck')}, 88%, 62%); clip-path:polygon(${getUserHead(i.userId,'polygon')}% 0,100% 100%,0% 100%); transform: rotate(${getUserHead(i.userId,'rotate')}deg)`\"\r\n          ></div>\r\n        </div>\r\n        <div class=\"user-msg\">\r\n          <span\r\n            :style=\"i.userId == userId?' float: right;':''\"\r\n            :class=\"i.userId == userId?'right':'left'\"\r\n          >{{i.content}}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"input-box\">\r\n      <input type=\"text\" ref=\"sendMsg\" v-model=\"contentText\" @keyup.enter=\"sendText()\" />\r\n      <div class=\"btn\" :class=\"{['btn-active']:contentText}\" @click=\"sendText()\">发送</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n \r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      ws: null,\r\n      count: 0,\r\n      userId: null, //当前用户ID\r\n      list: [], //聊天记录的数组\r\n      contentText: \"\" //input输入的值\r\n    };\r\n  },\r\n  created() {\r\n    this.getUserID();\r\n  },\r\n  mounted() {\r\n    this.initWebSocket();\r\n  },\r\n  methods: {\r\n    //根据时间戳作为当前用户ID\r\n    getUserID() {\r\n      let time = new Date().getTime();\r\n      this.userId = time;\r\n    },\r\n    //根据userID生成一个随机头像\r\n    getUserHead(id, type) {\r\n      let ID = String(id);\r\n      if (type == \"bck\") {\r\n        return Number(ID.substring(ID.length - 3));\r\n      }\r\n      if (type == \"polygon\") {\r\n        return Number(ID.substring(ID.length - 2));\r\n      }\r\n      if (type == \"rotate\") {\r\n        return Number(ID.substring(ID.length - 3));\r\n      }\r\n    },\r\n    //滚动条到底部\r\n    scrollBottm() {\r\n      let el = this.$refs[\"msg-box\"];\r\n      el.scrollTop = el.scrollHeight;\r\n    },\r\n    //发送聊天信息\r\n    sendText() {\r\n      let _this = this;\r\n      _this.$refs[\"sendMsg\"].focus();\r\n      if (!_this.contentText) {\r\n        return;\r\n      }\r\n      let params = {\r\n        userId: _this.userId,\r\n        msg: _this.contentText\r\n      };\r\n      _this.ws.send(JSON.stringify(params)); //调用WebSocket send()发送信息的方法\r\n      _this.contentText = \"\";\r\n      setTimeout(() => {\r\n        _this.scrollBottm();\r\n      }, 500);\r\n    },\r\n    //进入页面创建websocket连接\r\n    initWebSocket() {\r\n      let _this = this;\r\n      //判断页面有没有存在websocket连接\r\n      if (window.WebSocket) {\r\n        // 192.168.0.115 是我本地IP地址 此处的 :8181 端口号 要与后端配置的一致\r\n        let ws = new WebSocket(\"ws://127.0.0.1:8081\");\r\n        _this.ws = ws;\r\n        ws.onopen = function(e) {\r\n          console.log(\"服务器连接成功\");\r\n        };\r\n        ws.onclose = function(e) {\r\n          console.log(\"服务器连接关闭\");\r\n        };\r\n        ws.onerror = function() {\r\n          console.log(\"服务器连接出错\");\r\n        };\r\n        ws.onmessage = function(e) {\r\n          //接收服务器返回的数据\r\n          let resData = JSON.parse(e.data);\r\n          if (resData.funName == \"userCount\") {\r\n            _this.count = resData.users;\r\n            _this.list = resData.chat;\r\n            console.log(resData.chat);\r\n          } else {\r\n            _this.list = [\r\n              ..._this.list,\r\n              { userId: resData.userId, content: resData.msg }\r\n            ];\r\n          }\r\n        };\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n \r\n<style lang=\"scss\" scoped>\r\n.chat-box {\r\n  margin: 0 auto;\r\n  background: #fafafa;\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n  max-width: 700px;\r\n  header {\r\n    position: fixed;\r\n    width: 100%;\r\n    height: 3rem;\r\n    background: #409eff;\r\n    max-width: 700px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-weight: bold;\r\n    color: white;\r\n    font-size: 1rem;\r\n  }\r\n  .msg-box {\r\n    position: absolute;\r\n    height: calc(100% - 6.5rem);\r\n    width: 100%;\r\n    margin-top: 3rem;\r\n    overflow-y: scroll;\r\n    .msg {\r\n      width: 95%;\r\n      min-height: 2.5rem;\r\n      margin: 1rem 0.5rem;\r\n      position: relative;\r\n      display: flex;\r\n      justify-content: flex-start !important;\r\n      .user-head {\r\n        min-width: 2.5rem;\r\n        width: 20%;\r\n        width: 2.5rem;\r\n        height: 2.5rem;\r\n        border-radius: 50%;\r\n        background: #f1f1f1;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        .head {\r\n          width: 1.2rem;\r\n          height: 1.2rem;\r\n        }\r\n        // position: absolute;\r\n      }\r\n      .user-msg {\r\n        width: 80%;\r\n        // position: absolute;\r\n        word-break: break-all;\r\n        position: relative;\r\n        z-index: 5;\r\n        span {\r\n          display: inline-block;\r\n          padding: 0.5rem 0.7rem;\r\n          border-radius: 0.5rem;\r\n          margin-top: 0.2rem;\r\n          font-size: 0.88rem;\r\n        }\r\n        .left {\r\n          background: white;\r\n          animation: toLeft 0.5s ease both 1;\r\n        }\r\n        .right {\r\n          background: #53a8ff;\r\n          color: white;\r\n          animation: toright 0.5s ease both 1;\r\n        }\r\n        @keyframes toLeft {\r\n          0% {\r\n            opacity: 0;\r\n            transform: translateX(-10px);\r\n          }\r\n          100% {\r\n            opacity: 1;\r\n            transform: translateX(0px);\r\n          }\r\n        }\r\n        @keyframes toright {\r\n          0% {\r\n            opacity: 0;\r\n            transform: translateX(10px);\r\n          }\r\n          100% {\r\n            opacity: 1;\r\n            transform: translateX(0px);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .input-box {\r\n    padding: 0 0.5rem;\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n    height: 3.5rem;\r\n    background: #fafafa;\r\n    box-shadow: 0 0 5px #ccc;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    input {\r\n      height: 2.3rem;\r\n      display: inline-block;\r\n      width: 100%;\r\n      padding: 0.5rem;\r\n      border: none;\r\n      border-radius: 0.2rem;\r\n      font-size: 0.88rem;\r\n    }\r\n    .btn {\r\n      height: 2.3rem;\r\n      min-width: 4rem;\r\n      background: #e0e0e0;\r\n      padding: 0.5rem;\r\n      font-size: 0.88rem;\r\n      color: white;\r\n      text-align: center;\r\n      border-radius: 0.2rem;\r\n      margin-left: 0.5rem;\r\n      transition: 0.5s;\r\n    }\r\n    .btn-active {\r\n      background: #409eff;\r\n    }\r\n  }\r\n}\r\n</style>"]}]}