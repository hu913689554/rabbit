{"remainingRequest":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js!G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\src\\views\\chatroom\\chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\src\\views\\chatroom\\chat.vue","mtime":1646987707157},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\babel.config.js","mtime":1646385770904},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\基础文档\\Documents\\GitDemo\\rabbit\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJHOi9cdTU3RkFcdTc4NDBcdTY1ODdcdTY4NjMvRG9jdW1lbnRzL0dpdERlbW8vcmFiYml0L3Z1ZS1lbGVtZW50LWFkbWluL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmpzb24uc3RyaW5naWZ5LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KZXhwb3J0IGRlZmF1bHQgewogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB3czogbnVsbCwKICAgICAgY291bnQ6IDAsCiAgICAgIHVzZXJJZDogbnVsbCwKICAgICAgLy/lvZPliY3nlKjmiLdJRAogICAgICBsaXN0OiBbXSwKICAgICAgLy/ogYrlpKnorrDlvZXnmoTmlbDnu4QKICAgICAgY29udGVudFRleHQ6ICIiIC8vaW5wdXTovpPlhaXnmoTlgLwKCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0VXNlcklEKCk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdGhpcy5pbml0V2ViU29ja2V0KCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICAvL+agueaNruaXtumXtOaIs+S9nOS4uuW9k+WJjeeUqOaIt0lECiAgICBnZXRVc2VySUQ6IGZ1bmN0aW9uIGdldFVzZXJJRCgpIHsKICAgICAgdmFyIHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgdGhpcy51c2VySWQgPSB0aW1lOwogICAgfSwKICAgIC8v5qC55o2udXNlcklE55Sf5oiQ5LiA5Liq6ZqP5py65aS05YOPCiAgICBnZXRVc2VySGVhZDogZnVuY3Rpb24gZ2V0VXNlckhlYWQoaWQsIHR5cGUpIHsKICAgICAgdmFyIElEID0gU3RyaW5nKGlkKTsKCiAgICAgIGlmICh0eXBlID09ICJiY2siKSB7CiAgICAgICAgcmV0dXJuIE51bWJlcihJRC5zdWJzdHJpbmcoSUQubGVuZ3RoIC0gMykpOwogICAgICB9CgogICAgICBpZiAodHlwZSA9PSAicG9seWdvbiIpIHsKICAgICAgICByZXR1cm4gTnVtYmVyKElELnN1YnN0cmluZyhJRC5sZW5ndGggLSAyKSk7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlID09ICJyb3RhdGUiKSB7CiAgICAgICAgcmV0dXJuIE51bWJlcihJRC5zdWJzdHJpbmcoSUQubGVuZ3RoIC0gMykpOwogICAgICB9CiAgICB9LAogICAgLy/mu5rliqjmnaHliLDlupXpg6gKICAgIHNjcm9sbEJvdHRtOiBmdW5jdGlvbiBzY3JvbGxCb3R0bSgpIHsKICAgICAgdmFyIGVsID0gdGhpcy4kcmVmc1sibXNnLWJveCJdOwogICAgICBlbC5zY3JvbGxUb3AgPSBlbC5zY3JvbGxIZWlnaHQ7CiAgICB9LAogICAgLy/lj5HpgIHogYrlpKnkv6Hmga8KICAgIHNlbmRUZXh0OiBmdW5jdGlvbiBzZW5kVGV4dCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLiRyZWZzWyJzZW5kTXNnIl0uZm9jdXMoKTsKCiAgICAgIGlmICghX3RoaXMuY29udGVudFRleHQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgdXNlcklkOiBfdGhpcy51c2VySWQsCiAgICAgICAgbXNnOiBfdGhpcy5jb250ZW50VGV4dAogICAgICB9OwoKICAgICAgX3RoaXMud3Muc2VuZChKU09OLnN0cmluZ2lmeShwYXJhbXMpKTsgLy/osIPnlKhXZWJTb2NrZXQgc2VuZCgp5Y+R6YCB5L+h5oGv55qE5pa55rOVCgoKICAgICAgX3RoaXMuY29udGVudFRleHQgPSAiIjsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuc2Nyb2xsQm90dG0oKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAvL+i/m+WFpemhtemdouWIm+W7undlYnNvY2tldOi/nuaOpQogICAgaW5pdFdlYlNvY2tldDogZnVuY3Rpb24gaW5pdFdlYlNvY2tldCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsgLy/liKTmlq3pobXpnaLmnInmsqHmnInlrZjlnKh3ZWJzb2NrZXTov57mjqUKCgogICAgICBpZiAod2luZG93LldlYlNvY2tldCkgewogICAgICAgIC8vIDE5Mi4xNjguMC4xMTUg5piv5oiR5pys5ZywSVDlnLDlnYAg5q2k5aSE55qEIDo4MTgxIOerr+WPo+WPtyDopoHkuI7lkI7nq6/phY3nva7nmoTkuIDoh7QKICAgICAgICB2YXIgd3MgPSBuZXcgV2ViU29ja2V0KCJ3czovLzEyNy4wLjAuMTo4MDgxIik7CiAgICAgICAgX3RoaXMud3MgPSB3czsKCiAgICAgICAgd3Mub25vcGVuID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLmnI3liqHlmajov57mjqXmiJDlip8iKTsKICAgICAgICB9OwoKICAgICAgICB3cy5vbmNsb3NlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLmnI3liqHlmajov57mjqXlhbPpl60iKTsKICAgICAgICB9OwoKICAgICAgICB3cy5vbmVycm9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coIuacjeWKoeWZqOi/nuaOpeWHuumUmSIpOwogICAgICAgIH07CgogICAgICAgIHdzLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAvL+aOpeaUtuacjeWKoeWZqOi/lOWbnueahOaVsOaNrgogICAgICAgICAgdmFyIHJlc0RhdGEgPSBKU09OLnBhcnNlKGUuZGF0YSk7CgogICAgICAgICAgaWYgKHJlc0RhdGEuZnVuTmFtZSA9PSAidXNlckNvdW50IikgewogICAgICAgICAgICBfdGhpcy5jb3VudCA9IHJlc0RhdGEudXNlcnM7CiAgICAgICAgICAgIF90aGlzLmxpc3QgPSByZXNEYXRhLmNoYXQ7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc0RhdGEuY2hhdCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy5saXN0ID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfdGhpcy5saXN0KSwgW3sKICAgICAgICAgICAgICB1c2VySWQ6IHJlc0RhdGEudXNlcklkLAogICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc0RhdGEubXNnCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9CiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;AACAA,MADA,kBACA;AACA;AACAC,cADA;AAEAC,cAFA;AAGAC,kBAHA;AAGA;AACAC,cAJA;AAIA;AACAC,qBALA,CAKA;;AALA;AAOA,GATA;AAUAC,SAVA,qBAUA;AACA;AACA,GAZA;AAaAC,SAbA,qBAaA;AACA;AACA,GAfA;AAgBAC;AACA;AACAC,aAFA,uBAEA;AACA;AACA;AACA,KALA;AAMA;AACAC,eAPA,uBAOAC,EAPA,EAOAC,IAPA,EAOA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AACA,KAlBA;AAmBA;AACAC,eApBA,yBAoBA;AACA;AACAC;AACA,KAvBA;AAwBA;AACAC,YAzBA,sBAyBA;AACA;;AACAC;;AACA;AACA;AACA;;AACA;AACAb,4BADA;AAEAc;AAFA;;AAIAD,4CAVA,CAUA;;;AACAA;AACAE;AACAF;AACA,OAFA,EAEA,GAFA;AAGA,KAxCA;AAyCA;AACAG,iBA1CA,2BA0CA;AACA,uBADA,CAEA;;;AACA;AACA;AACA;AACAH;;AACAf;AACAmB;AACA,SAFA;;AAGAnB;AACAmB;AACA,SAFA;;AAGAnB;AACAmB;AACA,SAFA;;AAGAnB;AACA;AACA;;AACA;AACAe;AACAA;AACAI;AACA,WAJA,MAIA;AACAJ,sDACAA,UADA,IAEA;AAAAb;AAAAkB;AAAA,aAFA;AAIA;AACA,SAbA;AAcA;AACA;AAzEA;AAhBA","names":["data","ws","count","userId","list","contentText","created","mounted","methods","getUserID","getUserHead","id","type","scrollBottm","el","sendText","_this","msg","setTimeout","initWebSocket","console","content"],"sourceRoot":"src/views/chat","sources":["chat.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-box\">\r\n    <header>聊天室人数：{{count}}</header>\r\n    <div class=\"msg-box\" ref=\"msg-box\">\r\n      <div\r\n        v-for=\"(i,index) in list\"\r\n        :key=\"index\"\r\n        class=\"msg\"\r\n        :style=\"i.userId == userId?'flex-direction:row-reverse':''\"\r\n      >\r\n        <div class=\"user-head\">\r\n          <div\r\n            class=\"head\"\r\n            :style=\"` background: hsl(${getUserHead(i.userId,'bck')}, 88%, 62%); clip-path:polygon(${getUserHead(i.userId,'polygon')}% 0,100% 100%,0% 100%); transform: rotate(${getUserHead(i.userId,'rotate')}deg)`\"\r\n          ></div>\r\n        </div>\r\n        <div class=\"user-msg\">\r\n          <span\r\n            :style=\"i.userId == userId?' float: right;':''\"\r\n            :class=\"i.userId == userId?'right':'left'\"\r\n          >{{i.content}}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"input-box\">\r\n      <input type=\"text\" ref=\"sendMsg\" v-model=\"contentText\" @keyup.enter=\"sendText()\" />\r\n      <div class=\"btn\" :class=\"{['btn-active']:contentText}\" @click=\"sendText()\">发送</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n \r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      ws: null,\r\n      count: 0,\r\n      userId: null, //当前用户ID\r\n      list: [], //聊天记录的数组\r\n      contentText: \"\" //input输入的值\r\n    };\r\n  },\r\n  created() {\r\n    this.getUserID();\r\n  },\r\n  mounted() {\r\n    this.initWebSocket();\r\n  },\r\n  methods: {\r\n    //根据时间戳作为当前用户ID\r\n    getUserID() {\r\n      let time = new Date().getTime();\r\n      this.userId = time;\r\n    },\r\n    //根据userID生成一个随机头像\r\n    getUserHead(id, type) {\r\n      let ID = String(id);\r\n      if (type == \"bck\") {\r\n        return Number(ID.substring(ID.length - 3));\r\n      }\r\n      if (type == \"polygon\") {\r\n        return Number(ID.substring(ID.length - 2));\r\n      }\r\n      if (type == \"rotate\") {\r\n        return Number(ID.substring(ID.length - 3));\r\n      }\r\n    },\r\n    //滚动条到底部\r\n    scrollBottm() {\r\n      let el = this.$refs[\"msg-box\"];\r\n      el.scrollTop = el.scrollHeight;\r\n    },\r\n    //发送聊天信息\r\n    sendText() {\r\n      let _this = this;\r\n      _this.$refs[\"sendMsg\"].focus();\r\n      if (!_this.contentText) {\r\n        return;\r\n      }\r\n      let params = {\r\n        userId: _this.userId,\r\n        msg: _this.contentText\r\n      };\r\n      _this.ws.send(JSON.stringify(params)); //调用WebSocket send()发送信息的方法\r\n      _this.contentText = \"\";\r\n      setTimeout(() => {\r\n        _this.scrollBottm();\r\n      }, 500);\r\n    },\r\n    //进入页面创建websocket连接\r\n    initWebSocket() {\r\n      let _this = this;\r\n      //判断页面有没有存在websocket连接\r\n      if (window.WebSocket) {\r\n        // 192.168.0.115 是我本地IP地址 此处的 :8181 端口号 要与后端配置的一致\r\n        let ws = new WebSocket(\"ws://127.0.0.1:8081\");\r\n        _this.ws = ws;\r\n        ws.onopen = function(e) {\r\n          console.log(\"服务器连接成功\");\r\n        };\r\n        ws.onclose = function(e) {\r\n          console.log(\"服务器连接关闭\");\r\n        };\r\n        ws.onerror = function() {\r\n          console.log(\"服务器连接出错\");\r\n        };\r\n        ws.onmessage = function(e) {\r\n          //接收服务器返回的数据\r\n          let resData = JSON.parse(e.data);\r\n          if (resData.funName == \"userCount\") {\r\n            _this.count = resData.users;\r\n            _this.list = resData.chat;\r\n            console.log(resData.chat);\r\n          } else {\r\n            _this.list = [\r\n              ..._this.list,\r\n              { userId: resData.userId, content: resData.msg }\r\n            ];\r\n          }\r\n        };\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n \r\n<style lang=\"scss\" scoped>\r\n.chat-box {\r\n  margin: 0 auto;\r\n  background: #fafafa;\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n  max-width: 700px;\r\n  header {\r\n    position: fixed;\r\n    width: 100%;\r\n    height: 3rem;\r\n    background: #409eff;\r\n    max-width: 700px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-weight: bold;\r\n    color: white;\r\n    font-size: 1rem;\r\n  }\r\n  .msg-box {\r\n    position: absolute;\r\n    height: calc(100% - 6.5rem);\r\n    width: 100%;\r\n    margin-top: 3rem;\r\n    overflow-y: scroll;\r\n    .msg {\r\n      width: 95%;\r\n      min-height: 2.5rem;\r\n      margin: 1rem 0.5rem;\r\n      position: relative;\r\n      display: flex;\r\n      justify-content: flex-start !important;\r\n      .user-head {\r\n        min-width: 2.5rem;\r\n        width: 20%;\r\n        width: 2.5rem;\r\n        height: 2.5rem;\r\n        border-radius: 50%;\r\n        background: #f1f1f1;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        .head {\r\n          width: 1.2rem;\r\n          height: 1.2rem;\r\n        }\r\n        // position: absolute;\r\n      }\r\n      .user-msg {\r\n        width: 80%;\r\n        // position: absolute;\r\n        word-break: break-all;\r\n        position: relative;\r\n        z-index: 5;\r\n        span {\r\n          display: inline-block;\r\n          padding: 0.5rem 0.7rem;\r\n          border-radius: 0.5rem;\r\n          margin-top: 0.2rem;\r\n          font-size: 0.88rem;\r\n        }\r\n        .left {\r\n          background: white;\r\n          animation: toLeft 0.5s ease both 1;\r\n        }\r\n        .right {\r\n          background: #53a8ff;\r\n          color: white;\r\n          animation: toright 0.5s ease both 1;\r\n        }\r\n        @keyframes toLeft {\r\n          0% {\r\n            opacity: 0;\r\n            transform: translateX(-10px);\r\n          }\r\n          100% {\r\n            opacity: 1;\r\n            transform: translateX(0px);\r\n          }\r\n        }\r\n        @keyframes toright {\r\n          0% {\r\n            opacity: 0;\r\n            transform: translateX(10px);\r\n          }\r\n          100% {\r\n            opacity: 1;\r\n            transform: translateX(0px);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .input-box {\r\n    padding: 0 0.5rem;\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n    height: 3.5rem;\r\n    background: #fafafa;\r\n    box-shadow: 0 0 5px #ccc;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    input {\r\n      height: 2.3rem;\r\n      display: inline-block;\r\n      width: 100%;\r\n      padding: 0.5rem;\r\n      border: none;\r\n      border-radius: 0.2rem;\r\n      font-size: 0.88rem;\r\n    }\r\n    .btn {\r\n      height: 2.3rem;\r\n      min-width: 4rem;\r\n      background: #e0e0e0;\r\n      padding: 0.5rem;\r\n      font-size: 0.88rem;\r\n      color: white;\r\n      text-align: center;\r\n      border-radius: 0.2rem;\r\n      margin-left: 0.5rem;\r\n      transition: 0.5s;\r\n    }\r\n    .btn-active {\r\n      background: #409eff;\r\n    }\r\n  }\r\n}\r\n</style>"]}]}