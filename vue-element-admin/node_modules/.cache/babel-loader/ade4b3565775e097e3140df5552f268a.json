{"remainingRequest":"D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js!D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\src\\store\\modules\\permission.js","dependencies":[{"path":"D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\src\\store\\modules\\permission.js","mtime":1647145291466},{"path":"D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\babel.config.js","mtime":1646911679241},{"path":"D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\Work\\源码\\学习\\rabbit\\vue-element-admin\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovV29yay9cdTZFOTBcdTc4MDEvXHU1QjY2XHU0RTYwL3JhYmJpdC92dWUtZWxlbWVudC1hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgeyBhc3luY1JvdXRlcywgY29uc3RhbnRSb3V0ZXMgfSBmcm9tICdAL3JvdXRlcic7CmltcG9ydCB7IGdldE1lbnUgfSBmcm9tICdAL2FwaS91c2VyJzsKaW1wb3J0IExheW91dCBmcm9tICdAL2xheW91dCc7IC8vIExheW91dCDmmK/mnrbmnoTnu4Tku7bvvIzkuI3lnKjlkI7lj7Dov5Tlm57vvIzlnKjmlofku7bph4zljZXni6zlvJXlhaUKCi8qKg0KICogVXNlIG1ldGEucm9sZSB0byBkZXRlcm1pbmUgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgcGVybWlzc2lvbg0KICogQHBhcmFtIHJvbGVzDQogKiBAcGFyYW0gcm91dGUNCiAqLwoKZnVuY3Rpb24gaGFzUGVybWlzc2lvbihyb2xlcywgcm91dGUpIHsKICBpZiAocm91dGUubWV0YSAmJiByb3V0ZS5tZXRhLnJvbGVzKSB7CiAgICByZXR1cm4gcm9sZXMuc29tZShmdW5jdGlvbiAocm9sZSkgewogICAgICByZXR1cm4gcm91dGUubWV0YS5yb2xlcy5pbmNsdWRlcyhyb2xlKTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KLyoqDQogKiBGaWx0ZXIgYXN5bmNocm9ub3VzIHJvdXRpbmcgdGFibGVzIGJ5IHJlY3Vyc2lvbg0KICogQHBhcmFtIHJvdXRlcyBhc3luY1JvdXRlcw0KICogQHBhcmFtIHJvbGVzDQogKi8KCgpleHBvcnQgZnVuY3Rpb24gZmlsdGVyQXN5bmNSb3V0ZXMocm91dGVzLCByb2xlcykgewogIHZhciByZXMgPSBbXTsKICByb3V0ZXMuZm9yRWFjaChmdW5jdGlvbiAocm91dGUpIHsKICAgIHZhciB0bXAgPSBfb2JqZWN0U3ByZWFkKHt9LCByb3V0ZSk7CgogICAgaWYgKGhhc1Blcm1pc3Npb24ocm9sZXMsIHRtcCkpIHsKICAgICAgaWYgKHRtcC5jaGlsZHJlbikgewogICAgICAgIHRtcC5jaGlsZHJlbiA9IGZpbHRlckFzeW5jUm91dGVzKHRtcC5jaGlsZHJlbiwgcm9sZXMpOwogICAgICB9CgogICAgICByZXMucHVzaCh0bXApOwogICAgfQogIH0pOwogIHJldHVybiByZXM7Cn0KdmFyIHN0YXRlID0gewogIHJvdXRlczogW10sCiAgYWRkUm91dGVzOiBbXQp9Owp2YXIgbXV0YXRpb25zID0gewogIFNFVF9ST1VURVM6IGZ1bmN0aW9uIFNFVF9ST1VURVMoc3RhdGUsIHJvdXRlcykgewogICAgc3RhdGUuYWRkUm91dGVzID0gcm91dGVzOwogICAgc3RhdGUucm91dGVzID0gY29uc3RhbnRSb3V0ZXMuY29uY2F0KHJvdXRlcyk7IC8vIHJvdXRlcwogIH0KfTsKZXhwb3J0IHZhciBsb2FkVmlldyA9IGZ1bmN0aW9uIGxvYWRWaWV3KHZpZXcpIHsKICAvLyDot6/nlLHmh5LliqDovb0KICByZXR1cm4gZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgIHJldHVybiByZXF1aXJlKFsiQC92aWV3cy8iLmNvbmNhdCh2aWV3KV0sIHJlc29sdmUpOwogIH07Cn07CgpmdW5jdGlvbiBmaWx0ZXJBc3luY1JvdXRlcihhc3luY1JvdXRlck1hcCkgewogIC8vIOmBjeWOhuWQjuWPsOS8oOadpeeahOi3r+eUseWtl+espuS4su+8jOi9rOaNouS4uue7hOS7tuWvueixoQogIHZhciBhY2Nlc3NlZFJvdXRlcnMgPSBhc3luY1JvdXRlck1hcC5maWx0ZXIoZnVuY3Rpb24gKHJvdXRlKSB7CiAgICBjb25zb2xlLmxvZygn5byA5aeL5rOo5YaM57uE5Lu2Jyk7CiAgICBjb25zb2xlLmxvZyhyb3V0ZSk7CgogICAgaWYgKHJvdXRlLmNvbXBvbmVudCkgewogICAgICBpZiAocm91dGUuY29tcG9uZW50ID09PSAnTGF5b3V0JykgewogICAgICAgIC8vIExheW91dOe7hOS7tueJueauiuWkhOeQhgogICAgICAgIGNvbnNvbGUubG9nKCfms6jlhoxMYXlvdXTnu4Tku7YnICsgcm91dGUuY29tcG9uZW50KTsKICAgICAgICByb3V0ZS5jb21wb25lbnQgPSBMYXlvdXQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coJ+azqOWGjOiHquWumuS5iee7hOS7ticgKyByb3V0ZS5jb21wb25lbnQpOyAvL3JvdXRlLmNvbXBvbmVudCA9ICgpID0+IGltcG9ydChzdHIpCgogICAgICAgIHJvdXRlLmNvbXBvbmVudCA9IGxvYWRWaWV3KHJvdXRlLmNvbXBvbmVudCk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAocm91dGUuY2hpbGRyZW4gJiYgcm91dGUuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgIHJvdXRlLmNoaWxkcmVuID0gZmlsdGVyQXN5bmNSb3V0ZXIocm91dGUuY2hpbGRyZW4pOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogIHJldHVybiBhY2Nlc3NlZFJvdXRlcnM7Cn0KCnZhciBhY3Rpb25zID0gewogIGdlbmVyYXRlUm91dGVzOiBmdW5jdGlvbiBnZW5lcmF0ZVJvdXRlcyhfcmVmLCByb2xlcykgewogICAgdmFyIGNvbW1pdCA9IF9yZWYuY29tbWl0OwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIGdldE1lbnUoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIHZhciBhY2Nlc3NlZFJvdXRlczsKICAgICAgICBhY2Nlc3NlZFJvdXRlcyA9IGZpbHRlckFzeW5jUm91dGVyKHJlc3BvbnNlLmRhdGEpOwogICAgICAgIGNvbnNvbGUubG9nKCfms6jlhozlrozmiJAnKTsKICAgICAgICBjb25zb2xlLmxvZyhhY2Nlc3NlZFJvdXRlcyk7CiAgICAgICAgY29tbWl0KCdTRVRfUk9VVEVTJywgYWNjZXNzZWRSb3V0ZXMpOwogICAgICAgIHJlc29sdmUoYWNjZXNzZWRSb3V0ZXMpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgIH0pOyAvLyBsZXQgYWNjZXNzZWRSb3V0ZXMKICAgICAgLy8gaWYgKHJvbGVzLmluY2x1ZGVzKCdhZG1pbicpKSB7CiAgICAgIC8vICAgYWNjZXNzZWRSb3V0ZXMgPSBhc3luY1JvdXRlcyB8fCBbXQogICAgICAvLyB9IGVsc2UgewogICAgICAvLyAgIGFjY2Vzc2VkUm91dGVzID0gZmlsdGVyQXN5bmNSb3V0ZXMoYXN5bmNSb3V0ZXMsIHJvbGVzKQogICAgICAvLyB9CiAgICAgIC8vIGNvbW1pdCgnU0VUX1JPVVRFUycsIGFjY2Vzc2VkUm91dGVzKQogICAgICAvLyByZXNvbHZlKGFjY2Vzc2VkUm91dGVzKQogICAgfSk7CiAgfQp9OwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZXNwYWNlZDogdHJ1ZSwKICBzdGF0ZTogc3RhdGUsCiAgbXV0YXRpb25zOiBtdXRhdGlvbnMsCiAgYWN0aW9uczogYWN0aW9ucwp9Ow=="},{"version":3,"sources":["D:/Work/源码/学习/rabbit/vue-element-admin/src/store/modules/permission.js"],"names":["asyncRoutes","constantRoutes","getMenu","Layout","hasPermission","roles","route","meta","some","role","includes","filterAsyncRoutes","routes","res","forEach","tmp","children","push","state","addRoutes","mutations","SET_ROUTES","concat","loadView","view","resolve","require","filterAsyncRouter","asyncRouterMap","accessedRouters","filter","console","log","component","length","actions","generateRoutes","commit","Promise","then","response","accessedRoutes","data","catch","error","namespaced"],"mappings":"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","sourcesContent":["import { asyncRoutes, constantRoutes } from '@/router'\r\nimport { getMenu } from '@/api/user'\r\nimport Layout from '@/layout' // Layout 是架构组件，不在后台返回，在文件里单独引入\r\n/**\r\n * Use meta.role to determine if the current user has permission\r\n * @param roles\r\n * @param route\r\n */\r\nfunction hasPermission(roles, route) {\r\n  if (route.meta && route.meta.roles) {\r\n    return roles.some(role => route.meta.roles.includes(role))\r\n  } else {\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n * Filter asynchronous routing tables by recursion\r\n * @param routes asyncRoutes\r\n * @param roles\r\n */\r\nexport function filterAsyncRoutes(routes, roles) {\r\n  const res = []\r\n\r\n  routes.forEach(route => {\r\n    const tmp = { ...route }\r\n    if (hasPermission(roles, tmp)) {\r\n      if (tmp.children) {\r\n        tmp.children = filterAsyncRoutes(tmp.children, roles)\r\n      }\r\n      res.push(tmp)\r\n    }\r\n  })\r\n\r\n  return res\r\n}\r\n\r\nconst state = {\r\n  routes: [],\r\n  addRoutes: []\r\n}\r\n\r\nconst mutations = {\r\n  SET_ROUTES: (state, routes) => {\r\n    state.addRoutes = routes\r\n    state.routes = constantRoutes.concat(routes) // routes\r\n  }\r\n}\r\nexport const loadView = (view) => { // 路由懒加载\r\n  return (resolve) => require([`@/views/${view}`], resolve)\r\n}\r\nfunction filterAsyncRouter(asyncRouterMap) { // 遍历后台传来的路由字符串，转换为组件对象\r\n  const accessedRouters = asyncRouterMap.filter(route => {\r\n    console.log('开始注册组件')\r\n    console.log(route)\r\n    if (route.component) {\r\n      if (route.component === 'Layout') { // Layout组件特殊处理\r\n        console.log('注册Layout组件' + route.component)\r\n        route.component = Layout\r\n      } else {\r\n        console.log('注册自定义组件' + route.component)\r\n        //route.component = () => import(str)\r\n        route.component=loadView(route.component)\r\n      }\r\n    }\r\n    if (route.children && route.children.length) {\r\n      route.children = filterAsyncRouter(route.children)\r\n    }\r\n    return true\r\n  })\r\n\r\n  return accessedRouters\r\n}\r\n\r\nconst actions = {\r\n\r\n  generateRoutes({ commit }, roles) {\r\n    return new Promise(resolve => {\r\n      getMenu().then(response => {\r\n        let accessedRoutes\r\n        accessedRoutes = filterAsyncRouter(response.data)\r\n        console.log('注册完成')\r\n        console.log(accessedRoutes)\r\n        commit('SET_ROUTES', accessedRoutes)\r\n        resolve(accessedRoutes)\r\n      }).catch(error => {\r\n        console.log(error)\r\n      })\r\n\r\n      // let accessedRoutes\r\n      // if (roles.includes('admin')) {\r\n      //   accessedRoutes = asyncRoutes || []\r\n      // } else {\r\n      //   accessedRoutes = filterAsyncRoutes(asyncRoutes, roles)\r\n      // }\r\n\r\n      // commit('SET_ROUTES', accessedRoutes)\r\n\r\n      // resolve(accessedRoutes)\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n}\r\n"]}]}